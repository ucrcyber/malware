import paramiko
import subprocess
import sys
import socket
from time import sleep
from netaddr import IPNetwork


def connect(ip, usernames, passwords):
    print("Attacking: {}".format(ip))
    # do stuff here


def portscan(*host_port):
    sock = socket.socket()
    sock.settimeout(0.1)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

    connected = sock.connect_ex(host_port) is 0

    sock.close()
    return connected


def scan(usernames, passwords):
    print('Started scanning')
    res = str(subprocess.check_output(['ip', 'addr']))
    hostIp = ([x for x in [x for x in res.split('\\n') if 'inet' in x and 'inet6' not in x][-1].split(' ') if '.' in x][0])
    for ip in IPNetwork(hostIp):
        # do stuff here


def execute(ssh):
    print('Executing malicious commands')
    sftpClient = ssh.open_sftp()
    # do stuff here
    sftpClient.put()
    ssh.exec_command('')


if __name__ == "__main__":
    usernames = []
    passwords = []

    with open(sys.argv[1], 'r') as u, open(sys.argv[2], 'r') as p:
        passwords = [x.strip() for x in p.readlines()]
        usernames = [x.strip() for x in u.readlines()]

    ssh = paramiko.SSHClient()
    ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

    scan(usernames, passwords)
    ssh.close()
